<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      
        <title>RobComp - Resumos - Lucas Espina</title>
      
    
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:700|Oxygen+Mono|Source+Sans+Pro:700|Source+Serif+Pro&amp;display=swap">
    <link rel="stylesheet" href="../assets/css/main.css">
    <script>
      // SETUP GLOBAL CONSTANTS
      var base_url = '..';
      
      var telemetryEnabled = false;
      var backendUrl = "";
      var courseSlug = "";
      
      
      var dashboardEnabled = false;
      var tagTree = {};
      

      // SETUP PLUGIN
      window.initialized = false;
      if (!window.initializers) window.initializers = [];
      window.registerInitializer = (initialize) => {
        if (window.initialized) initialize();
        else window.initializers.push(initialize);
      };
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://unpkg.com/hyperscript.org"></script>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="../assets/js/main.js"></script>
    
    <link rel="stylesheet" href="../css/ansi-colours.css"><link rel="stylesheet" href="../css/jupyter-cells.css"><link rel="stylesheet" href="../css/pandas-dataframe.css">
  </head>
  <body>
    <div class="ah-main-container">
      <header class="ah-header">
        <button class="ah-menu-btn ah-button ah-button--borderless"
                aria-label="toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/>
</svg>
        </button>
        <a href=".."
           title="Resumos - Lucas Espina"
           class="ah-logo"
           aria-label="Resumos - Lucas Espina">
          Resumos - Lucas Espina
        </a>
        <div class="ah-header--right">
          
          
          
          <button id="resetHandoutButton">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
</svg></span>
          </button>
          

          
        </div>
      </header>
      <nav class="ah-navigation preload">
        <div class="ah-nav-container">
          <button class="ah-menu-btn ah-button ah-button--borderless close-menu"
                  aria-label="close menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/>
</svg>
          </button>
          <ul class="ah-nav-body">
            
              
  
    <li>
      <a href="..">Home</a>
    </li>
  

            
              
  <li class="ah-togglable-item opened">
    <span class="ah-togglable-handle">Resumos</span>
    <ul>
      
        
  
    <li class="active ah-togglable-item opened">
      <span class="ah-togglable-handle">RobComp</span>
      <ul>
        
      </ul>
    </li>
  

      
        
  
    <li>
      <a href="../desagil/">DesÁgil</a>
    </li>
  

      
        
  
    <li>
      <a href="../elesis/">Elesis</a>
    </li>
  

      
    </ul>
  </li>

            
              
  
    <li>
      <a href="../sobre/">Sobre</a>
    </li>
  

            
          </ul>
        </div>
      </nav>
      <main class="ah-content ah-typeset">
        
          <div class="ah-title-box">
            <ul class="ah-breadcrumbs">
              
                
                  
                    <li>Resumos</li>
                  
                
                <li>RobComp</li>
            </ul>
            
            
          </div>
          
            <section class="progress-section show">
<h1 id="resumo-robcomp">Resumo RobComp</h1>
<hr />
<h2 id="sumario">Sumário</h2>
<ul>
<li><a href="#ros2">ROS2</a><ul>
<li><a href="#executando-o-ros2">Executando o ROS2</a></li>
<li><a href="#executando-o-teleop">Executando o Teleop</a></li>
<li><a href="#executando-o-rqt_image_view">Executando o rqt_image_view</a></li>
<li><a href="#topicos-e-mensagens">Tópicos e Mensagens</a><ul>
<li><a href="#listar-os-topicos">Listar os Tópicos</a></li>
<li><a href="#listar-o-tipo-de-mensagem">Listar o Tipo de Mensagem</a></li>
<li><a href="#visualizar-mensagens">Visualizar Mensagens</a></li>
<li><a href="#visualizando-a-estrutura-das-mensagens">Visualizando a Estrutura das Mensagens</a></li>
</ul>
</li>
<li><a href="#criar-um-novo-pacote">Criar um Novo Pacote</a></li>
<li><a href="#compilar-pacote">Compilar Pacote</a></li>
<li><a href="#maquina-de-estados">Máquina de Estados</a></li>
<li><a href="#arquivos-de-base">Arquivos de Base</a><ul>
<li><a href="#no-base">Nó Base</a></li>
<li><a href="#no-base-de-controle">Nó Base de Controle</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#opencv2">OpenCV2</a><ul>
<li><a href="#ler-a-imagem">Ler a Imagem</a></li>
<li><a href="#mostrar-a-imagem-na-tela">Mostrar a imagem na tela</a></li>
<li><a href="#imagens-como-matrizes">Imagens como matrizes</a></li>
<li><a href="#conversao-de-cores">Conversão de cores</a></li>
<li><a href="#copiar-uma-imagem">Copiar uma imagem</a></li>
<li><a href="#criar-uma-imagem-vazia">Criar uma imagem vazia</a></li>
<li><a href="#cortar-uma-imagem">Cortar uma imagem</a></li>
<li><a href="#minimo-maximo-media-etc">Mínimo, Máximo, Média, etc</a></li>
<li><a href="#operações-condicionais">Operações Condicionais</a></li>
<li><a href="#area">Área</a></li>
<li><a href="#mascaras">Máscaras</a><ul>
<li><a href="#mascara-de-imagens-em-preto-e-branco">Máscara de imagens em preto e branco</a></li>
<li><a href="#mascara-de-imagens-coloridas">Máscara de imagens coloridas</a></li>
</ul>
</li>
<li><a href="#indentificacao-de-obejtos">Indentificação de Obejtos</a><ul>
<li><a href="#filtrando-o-objeto">Filtrando o Objeto</a></li>
</ul>
</li>
<li><a href="#contornos">Contornos</a><ul>
<li><a href="#desenhar-contornos">Desenhar Contornos</a></li>
<li><a href="#medidas-dos-contornos">Medidas Dos Contornos</a></li>
<li><a href="#maior-contorno">Maior Contorno</a></li>
<li><a href="#desenhando-o-maior-contorno">Desenhando o Maior Contorno</a></li>
<li><a href="#centro-de-massa-do-maior-contorno">Centro de Massa do Maior Contorno</a></li>
<li><a href="#caixa-delimitadora">Caixa Delimitadora</a></li>
</ul>
</li>
<li><a href="#ferramenta-de-imagem">Ferramenta de Imagem</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="ros-2">ROS 2</h2>
<hr />
<h1 id="_1"></h1>
<h3 id="executando-o-ros2">Executando o ROS2</h3>
<div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>launch<span class="w"> </span>my_gazebo<span class="w"> </span>pista-23B.launch.py
</code></pre></div>
<h3 id="executando-o-teleop">Executando o Teleop</h3>
<div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>run<span class="w"> </span>teleop_twist_keyboard<span class="w"> </span>teleop_twist_keyboard<span class="w"> </span>
</code></pre></div>
<h3 id="executando-o-rqt_image_view">Executando o rqt_image_view</h3>
<div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>run<span class="w"> </span>rqt_image_view<span class="w"> </span>rqt_image_view
</code></pre></div>
<p><a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_2"></h1>
<h3 id="topicos-e-mensagens">Tópicos e Mensagens</h3>
<ul>
<li>
<p><strong>Nodes (Nós):</strong> Um nó é um processo que executa uma tarefa especifica na ROS. No nosso caso, um nó é um script python que vamos chamar diretamente.</p>
</li>
<li>
<p><strong>Topics (Tópicos):</strong> Os tópicos na ROS são barramentos onde a informação é trocada entre nós. Através de tópicos, nós podemos publicar e se inscrever para enviar e receber mensagens. Quando um nó publica uma mensagem ela é enviada para todos os nós que estão inscritos nesta mensagem. Tópicos são identificados por strings únicas.</p>
</li>
<li>
<p><strong>Messages (Mensagens):</strong> As mensagens são estruturas de dados que carregam informações. Elas são podem ser compostas por tipos primitivos, como inteiros, floats, strings, etc. ou por outras mensagens. As mensagens são usadas para publicar e receber informações nos tópicos.</p>
</li>
</ul>
<h1 id="_3"></h1>
<h3 id="listar-os-topicos">Listar os Tópicos</h3>
<p>Você pode listar os tópicos disponíveis com o seguinte o comando:
<div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>topic<span class="w"> </span>list
</code></pre></div>
O comando <strong>list</strong> retorna a lista de tópicos disponíveis na ROS no momento. Cada tópico transporta uma mensagem de um tipo específico. Para saber qual o tipo de mensagem que um tópico transporta, execute o seguinte comando:</p>
<h1 id="_4"></h1>
<h3 id="listar-o-tipo-de-mensagem">Listar o Tipo de Mensagem</h3>
<p><div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>topic<span class="w"> </span>info<span class="w"> </span><span class="o">{</span><span class="s2">&quot;Nome do Tópico&quot;</span><span class="o">}</span>
</code></pre></div>
O comando <strong>info</strong> informa o tipo de mensagem que o tópico transporta. </p>
<h1 id="_5"></h1>
<h3 id="visualizar-mensagens">Visualizar Mensagens</h3>
<p><div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>topic<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="o">{</span><span class="s2">&quot;Nome do Tópico&quot;</span><span class="o">}</span>
</code></pre></div>
O comando <strong>echo</strong> exibe as mensagens que estão sendo publicadas no tópico.</p>
<h1 id="_6"></h1>
<h3 id="visualizando-a-estrutura-das-mensagens">Visualizando a Estrutura das Mensagens</h3>
<p><div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>interface<span class="w"> </span>show<span class="w">  </span><span class="o">{</span><span class="s2">&quot;Nome do Pacote&quot;</span><span class="o">}</span>/msg/<span class="o">{</span><span class="s2">&quot;Nome da Mensagem&quot;</span><span class="o">}</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_7"></h1>
<h3 id="criar-um-novo-pacote">Criar um Novo Pacote</h3>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nb">cd</span><span class="w"> </span>~/colcon_ws/src
<span class="w">    </span>ros2<span class="w"> </span>pkg<span class="w"> </span>create<span class="w"> </span>--build-type<span class="w"> </span>ament_python<span class="w"> </span><span class="s2">&quot;Nome do pacote&quot;</span><span class="w"> </span>--dependencies<span class="w"> </span>rclpy<span class="w"> </span>std_msgs<span class="w"> </span>geometry_msgs<span class="w"> </span><span class="s2">&quot;Dependências do pacote&quot;</span>
</code></pre></div>
<h1 id="_8"></h1>
<p><strong>Onde</strong>: <br>
- <strong>ros2</strong> é o comando para executar o ROS2 <br>
- <strong>pkg create</strong> é o comando para criar um novo pacote <br>
- <strong>--build-type ament_python</strong> é o tipo de pacote que será criado, nesse caso, um pacote em Python <br>
- <strong>"Nome do pacote"</strong> é o nome do pacote que será criado <br>
- <strong>--dependencies rclpy std_msgs geometry_msgs</strong> são as dependências do pacote que será criado, nesse caso, o pacote depende do <strong>rclpy</strong>, <strong>std_msgs</strong> e <strong>geometry_msgs</strong> e <strong>Dependências do pacote</strong> são as demais dependências do pacote que será criado.</p>
<h1 id="_9"></h1>
<h3 id="compilar-pacote">Compilar Pacote</h3>
<p>Após criar um pacote, é necessário compilá-lo; utilizando o comando abaixo.
<div class="highlight"><pre><span></span><code>cb
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_10"></h1>
<h3 id="maquina-de-estados">Máquina de Estados</h3>
<p>Uma máquina de estados é um modelo que descreve como um robô ou sistema se comporta. Ela é composta por estados, que são condições do sistema, e transições, que são as mudanças entre esses estados.
Usando como exemplo um robô que segue uma linha, podemos definir os seguintes estados e as seguintes transições:</p>
<p><strong>Estados</strong>:</p>
<ul>
<li>
<p><strong>Andar pra frente:</strong> O robô anda pra frente rodando os dois motores em velocidade máxima.</p>
</li>
<li>
<p><strong>Virar pra direita:</strong> O robô vira para a direita rodando o motor esquerdo em velocidade máxima e o motor direito em velocidade mínima.</p>
</li>
<li>
<p><strong>Virar pra esquerda:</strong> O robô vira para a esquerda rodando o motor direito em velocidade máxima e o motor esquerdo em velocidade mínima.</p>
</li>
<li>
<p><strong>Parar:</strong> O robô para ambos os motores.</p>
</li>
</ul>
<p><strong>Transições</strong>:</p>
<ul>
<li>
<p><strong>Andar pra frente:</strong> O robô entra neste estado quando ambos os sensores estão detectando a linha.</p>
</li>
<li>
<p><strong>Virar pra direita:</strong> O robô entra neste estado quando apenas o sensor direito está detectando a linha.</p>
</li>
<li>
<p><strong>Virar pra esquerda:</strong> O robô entra neste estado quando apenas o sensor esquerdo está detectando a linha.</p>
</li>
<li>
<p><strong>Parar:</strong> O robô entra neste estado quando nenhum dos sensores está detectando a linha.</p>
</li>
</ul>
<p><strong>Nesse exemplo, a estrutura do código seria algo como:</strong></p>
<div class="highlight"><pre><span></span><code>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robot_state</span> <span class="o">=</span> <span class="s1">&#39;frente&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_machine</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;frente&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">andar_frente</span><span class="p">,</span>
            <span class="s1">&#39;direita&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virar_direita</span><span class="p">,</span>
            <span class="s1">&#39;esquerda&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virar_esquerda</span><span class="p">,</span>
            <span class="s1">&#39;parar&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parar</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">frente</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Código para andar pra frente</span>
    <span class="k">def</span> <span class="nf">direita</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Código para virar pra direita</span>
    <span class="k">def</span> <span class="nf">esquerda</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Código para virar pra esquerda</span>
    <span class="k">def</span> <span class="nf">parar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Código para parar</span>

    <span class="k">def</span> <span class="nf">control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_machine</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">robot_state</span><span class="p">]()</span>

        <span class="c1"># Código para verificar se o estado deve ser alterado</span>
</code></pre></div>
<h1 id="_11"></h1>
<p><strong>Onde</strong>:</p>
<ul>
<li><strong>self.robot_state</strong> é o estado atual do robô</li>
<li><strong>self.state_machine</strong> é um dicionário que mapeia os estados para as funções que devem ser executadas</li>
<li><strong>self.control()</strong> é a função que executa a máquina de estados</li>
<li><strong>self.state_machine [self.robot_state] ()</strong> executa a função correspondente ao estado atual do robô</li>
</ul>
<p><a href="#sumario">Voltar ao Sumário</a></p>
<h3 id="arquivos-de-base">Arquivos de Base</h3>
<p>São arquivos que servem de base para a criação de novos nós. </p>
<ul>
<li><strong>Nó Base:</strong> <a href="../arquivos-de-base/base/">base.py</a></li>
<li><strong>Nó Base de Controle:</strong> <a href="../arquivos-de-base/base_control/">base_control.py</a></li>
</ul>
<h1 id="_12"></h1>
<h4 id="no-base">Nó Base</h4>
<p>Quando executado, ele chama a função <code>control()</code> a cada 0,25 segundos. Este script é útil para criar um nó que se inscreve em um tópico e executa uma função a cada nova mensagem recebida, publicando uma mensagem em outro tópico.</p>
<h1 id="_13"></h1>
<h4 id="no-base-de-controle">Nó Base de Controle</h4>
<p>Neste script, definimos a máquina de estados do robô (no dicionário <code>self.state_machine</code>), o estado inicial (no atributo <code>self.robot_state</code>) e a função de controle (no método <code>self.control()</code>), que a cada 0,25 segundos, executa a função <code>self.state_machine[self.robot_state]()</code> e publica a ação de controle no tópico <code>cmd_vel</code> (<code>self.cmd_vel_pub.publish(self.twist)</code>).</p>
<p><strong>Dica:</strong> Em uma máquina de estados bem definida, a função de controle não precisa ser alterada, sendo ela a única função que publica no tópico <code>cmd_vel</code></p>
<h1 id="_14"></h1>
<p><a href="#sumario">Voltar ao Sumário</a></p>
<hr />
<h2 id="opencv2">OpenCV2</h2>
<hr />
<h1 id="_15"></h1>
<h3 id="ler-a-imagem">Ler a Imagem</h3>
<div class="highlight"><pre><span></span><code><span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="s2">&quot;exemplo.png&quot;</span><span class="p">)</span>
</code></pre></div>
<h1 id="_16"></h1>
<h3 id="mostrar-a-imagem-na-tela">Mostrar a Imagem na Tela</h3>
<div class="highlight"><pre><span></span><code><span class="n">cv2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="s2">&quot;Imagem&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">waitKey</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">destroyAllWindows</span><span class="p">()</span>
</code></pre></div>
<h1 id="_17"></h1>
<h3 id="imagens-como-matrizes">Imagens como Matrizes</h3>
<p>No OpenCV as imagens são matrizes do numpy
<div class="highlight"><pre><span></span><code><span class="n">mini_grid</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mini_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></p>
<p><div class="highlight"><pre><span></span><code># Output
(linhas, colunas, canais)
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_18"></h1>
<h3 id="conversao-de-cores">Conversão de Cores</h3>
<p>A ordem dos sub-pixels das imagens no OpenCV é <strong>BGR</strong>, em vez de <strong>RGB</strong>.</p>
<ul>
<li>
<p><strong>BGR para RGB</strong>
<div class="highlight"><pre><span></span><code><span class="n">img_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p><strong>BGR para Escala de Cinza</strong></p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">img_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><strong>BGR para HSV</strong></li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_19"></h1>
<h3 id="copiar-uma-imagem">Copiar uma Imagem</h3>
<div class="highlight"><pre><span></span><code><span class="n">img_copy</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</code></pre></div>
<h1 id="_20"></h1>
<h3 id="criar-uma-imagem-vazia">Criar uma Imagem Vazia</h3>
<div class="highlight"><pre><span></span><code><span class="n">img_vazia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">imagem</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))</span>
</code></pre></div>
<h1 id="_21"></h1>
<h3 id="cortar-uma-imagem">Cortar uma Imagem</h3>
<p><div class="highlight"><pre><span></span><code><span class="n">horizontal</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">vertical</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span>

<span class="c1"># Corte Horizontal</span>
<span class="n">horizontal</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">height</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Corte Vertical</span>
<span class="n">vertical</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_22"></h1>
<h3 id="minimo-maximo-media-etc">Mínimo, Máximo, Média, etc.</h3>
<p>Com o Numpy é fácil obter estatísticas da imagem. </p>
<p>Aqui vamos trabalhar com uma imagem em tons de cinza, mas desta vez vamos enviar um argumento para a função <code>cv2.imread</code> para ler a imagem diretamente em tons de cinza.</p>
<p><div class="highlight"><pre><span></span><code><span class="n">img_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

<span class="n">minimo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">img_gray</span><span class="p">)</span>
<span class="n">maximo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">img_gray</span><span class="p">)</span>
<span class="n">media</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img_gray</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimo: &quot;</span><span class="p">,</span> <span class="n">minimo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximo: &quot;</span><span class="p">,</span> <span class="n">maximo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Media: &quot;</span><span class="p">,</span> <span class="n">media</span><span class="p">)</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_23"></h1>
<h3 id="operacoes-condicionais">Operações Condicionais</h3>
<p>O Numpy permite fazer operações condicionais em arrays (imagens).</p>
<p>Por exemplo, podemos fazer uma operação que retorna torna todos os pixels maiores que a média sejam convertivos para 255 e os menores que a média para 0.</p>
<p><div class="highlight"><pre><span></span><code><span class="n">img_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

<span class="n">codicionado</span> <span class="o">=</span> <span class="n">img_gray</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">codicionado</span><span class="p">[</span><span class="n">codicionado</span> <span class="o">&lt;</span> <span class="n">media</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">codicionado</span><span class="p">[</span><span class="n">codicionado</span> <span class="o">&gt;=</span> <span class="n">media</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_24"></h1>
<h3 id="area">Área</h3>
<p>A função <code>cv2.inRange</code> realiza a operação de limiarização.</p>
<p>Para o caso de imagens preto e branco, a função <code>cv2.inRange</code> recebe como parâmetros a imagem de entrada, o <strong>valor mínimo</strong> e o <strong>valor máximo</strong> do intervalo de valores que serão considerados para a limiarização. </p>
<p>O resultado da função é uma imagem binária, onde os pixels que estão dentro do intervalo são brancos e os pixels que estão fora do intervalo são pretos.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img_gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

<span class="c1"># Criando a máscara </span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</code></pre></div>
<h1 id="_25"></h1>
<h3 id="mascara-de-imagens-coloridas">Máscara de Imagens Coloridas</h3>
<p>Para imagens coloridades deve-se trabalhar com a imagem no espaço de cores <strong>HSV</strong>.</p>
<ul>
<li><strong>HSV - Hue, Saturation, Value</strong></li>
</ul>
<p>A imagem abaixo mostra claramente como o canal H varia de acordo com a cor, seguindo o círculo de cores.</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/8/8f/HSV_cylinder.jpg" /></p>
<h1 id="_26"></h1>
<p>Onde o canal <strong>Hue</strong> indica a cor dentro do círculo de cores.
O canal <strong>Saturation</strong> indica a saturação da cor.
O canal <strong>Value</strong> indica a luminosidade da cor.</p>
<h1 id="_27"></h1>
<p><strong>Importante:</strong></p>
<p>No circulo acima, lembre-se de dividir o valor <code>H</code> por <code>2</code> no momento que estiver determinando seu filtro na OpenCV.
<code>S</code> e <code>V</code> são valores percentuais de <code>0%</code> até <code>100%</code>, lembre-se de converter para valores de <code>0 - 255</code> no momento que estiver determinando seu filtro na OpenCV.</p>
<h1 id="_28"></h1>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>

<span class="c1"># Convertendo a imagem para o espaço de cores HSV</span>
<span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>

<span class="c1"># Definindo os limites da máscara</span>
<span class="n">inferior</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">superior</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

<span class="c1"># Criando a máscara</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">img_hsv</span><span class="p">,</span> <span class="n">inferior</span><span class="p">,</span> <span class="n">superior</span><span class="p">)</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_29"></h1>
<h3 id="indentificacao-de-obejtos">Indentificação de Obejtos</h3>
<p><strong>Circulo HSV</strong> com os valores de <code>H</code> das cores</p>
<p><img src="https://thumbs.dreamstime.com/b/roda-de-cores-da-cor-nomeia-os-graus-rgb-78027630.jpg" width="400" height="400" /></p>
<h1 id="_30"></h1>
<ul>
<li>
<h5 id="filtrando-o-objeto">Filtrando o Objeto</h5>
</li>
</ul>
<p>A identificação de objetos muitas vezes começa com a segmentação através de máscaras.</p>
<p>Conforme ilustrado acima, a cor vermelha aparece em duas regiões distintas do círculo HSV: uma entre <code>0 e 30</code> graus e outra entre <code>330 e 360</code> graus.</p>
<p>Abaixo, temos o código para realizar a segmentação da cor vermelha, neste código, combinamos as duas máscaras resultantes utilizando o operador lógico OR do OpenCV, que retorna branco se pelo menos um dos pixels for branco. A função <code>cv2.bitwise_or</code> recebe os seguintes parâmetros:</p>
<ul>
<li><code>cv2.bitwise_or(src, src2, **mask)</code><ul>
<li><code>src1</code>: primeira imagem, ou máscara, de entrada ou matriz real.</li>
<li><code>src2</code>: segunda imagem, ou máscara, de entrada ou matriz real.</li>
<li><code>mask</code> (opcional): máscara de entrada de 8 bits. A operação será realizada apenas nos elementos especificados pela máscara.</li>
</ul>
</li>
</ul>
<p>Também temos o operator lógico AND, que retorna branco se ambos os pixels forem brancos, na função <code>cv2.bitwise_and</code>.</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>
<span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>

<span class="c1"># Definindo os limites da máscara 1</span>
<span class="n">cor_menor1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">172</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">cor_maior1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">180</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>

<span class="c1"># Criando a máscara 1</span>
<span class="n">mask_1</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">img_hsv</span><span class="p">,</span> <span class="n">cor_menor1</span><span class="p">,</span> <span class="n">cor_maior1</span><span class="p">)</span>

<span class="c1"># Definindo os limites da máscara 2</span>
<span class="n">cor_menor2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">cor_maior2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">])</span>

<span class="c1"># Criando a máscara 2</span>
<span class="n">mask_2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">img_hsv</span><span class="p">,</span> <span class="n">cor_menor2</span><span class="p">,</span> <span class="n">cor_maior2</span><span class="p">)</span>

<span class="c1"># Combinando as máscaras</span>
<span class="n">mask_combinada</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bitwise_or</span><span class="p">(</span><span class="n">mask_1</span><span class="p">,</span> <span class="n">mask_2</span><span class="p">)</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_31"></h1>
<h3 id="contornos">Contornos</h3>
<p>Os contornos podem ser encontrados em imagens binárias com <code>cv2.findContours</code>. Esses contornos podem ser usados para identificar e delimitar objetos. Contornos são úteis para encontrar a área, o centro de massa e a caixa delimitadora de um objeto. A função <code>cv2.findContours</code> recebe como parâmetros a imagem binária de entrada, o modo de organização dos contornos e o método de aproximação dos contornos.</p>
<p>Usamos a função a seguinte função para encontrar os contornos:
<div class="highlight"><pre><span></span><code><span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_CCOMP</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>
</code></pre></div></p>
<h1 id="_32"></h1>
<p><strong>Onde:</strong></p>
<ul>
<li><code>mask_combinada</code> é a imagem com a máscara binária de entrada.</li>
<li><code>cv2.RETR_CCOMP</code> indica que queremos organizar os contornos em componentes conexos e buracos dentro deles</li>
<li><code>cv2.CHAIN_APPROX_NONE</code> indica que queremos armazenar todos os pontos do contorno.</li>
<li><code>contours</code> é uma lista de contornos. Cada contorno é uma lista de pontos (x, y) que formam o polígono que delimita o contorno.</li>
<li><code>hierarchy</code> é uma lista indicando a organização dos contornos em termos dos componentes e de seus buracos.</li>
</ul>
<p>Os componentes conexos são representados através de seus contornos internos, ou seja, dos pixels de cada componente conexo que são vizinhos a pixels de fundo. </p>
<h1 id="_33"></h1>
<h3 id="desenhar-contornos">Desenhar Contornos</h3>
<p>Podemos desenhar contornos sobre a imagem para visualizar os objetos identificados.Para desenhar os contornos em uma imagem, usamos a função <code>cv2.drawContours()</code>, que usamos da forma:</p>
<div class="highlight"><pre><span></span><code><span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">contourssa</span><span class="p">,</span> <span class="n">indice</span><span class="p">,</span> <span class="n">cor</span><span class="p">)</span>
</code></pre></div>
<h1 id="_34"></h1>
<p><strong>Onde</strong>:
* <code>img</code> é a imagem colorida ou tons de cinza onde serão desenhados os contornos.
* <code>contours</code> é a lista de contornos obtida com <code>cv2.findContours()</code>, ou seja, recebe uma lista de lista. Então assumindo que <code>contours[i]</code> seja um contorno, a função esperaria uma sintaxe como <code>cv2.drawContours(img, [contours[i]], indice, cor)</code>.
* <code>indice</code> é o índice do contorno dentro da lista a ser desenhado; se <code>-1</code> desenha todos os contornos
* <code>cor</code> é a cor do pixel a ser usada para desenhar o contorno, por exemplo, <code>(255, 0, 0)</code> para azul. Se for <code>-1</code>, o contorno é <strong>preenchido</strong> com a cor.</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>

<span class="c1"># Encontrando os contornos</span>
<span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask_combinada</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_CCOMP</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>

<span class="c1"># Número de contornos</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Número de contornos: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">contours</span><span class="p">))</span>

<span class="c1"># Desenhando os contornos</span>
<span class="n">img_contornos</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">img_contornos</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_35"></h1>
<h3 id="medidas-dos-contornos">Medidas Dos Contornos</h3>
<p>A partir dos contornos, podemos tirar uma série de medidas como:
- <strong>Área:</strong> número de pixels pertencentes ao contorno, calculada com <code>cv2.contourArea(contour)</code>
- <strong>Centro de massa:</strong> linha e coluna do centro de massa do contorno
- <strong>Caixa delimitadora:</strong> menor retângulo que contém o contorno, calculada com <code>cv2.boundingRect(contour)</code></p>
<h1 id="_36"></h1>
<h3 id="maior-contorno">Maior Contorno</h3>
<p>Utilizando a função <code>cv2.contourArea()</code> podemos calcular a área de cada contorno e assim encontrar o maior contorno.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>

<span class="c1"># Encontrando os contornos</span>
<span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask_combinada</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_CCOMP</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>

<span class="c1"># Encontrando o maior contorno</span>
<span class="n">maior_contorno</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>
</code></pre></div>
<h1 id="_37"></h1>
<h3 id="desenhando-o-maior-contorno">Desenhando o Maior Contorno</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Desenhando o maior contorno</span>
<span class="n">img_maior_contorno</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">img_maior_contorno</span><span class="p">,</span> <span class="p">[</span><span class="n">maior_contorno</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<h1 id="_38"></h1>
<h3 id="centro-de-massa-do-maior-contorno">Centro de Massa do Maior Contorno</h3>
<p>O centro de massa de um contorno é calculado através da função <code>cv2.moments(contour)</code>, que retorna um dicionário com as seguintes chaves:
* <code>m00</code>: área do contorno
* <code>m10</code>: soma das coordenadas x dos pixels do contorno
* <code>m01</code>: soma das coordenadas y dos pixels do contorno</p>
<p>Essas chaves são usadas para calcular o centro de massa do contorno, que é dado por:</p>
<div class="highlight"><pre><span></span><code>cX = int(M[&quot;m10&quot;] / M[&quot;m00&quot;])
cY = int(M[&quot;m01&quot;] / M[&quot;m00&quot;])
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>

<span class="c1"># Imagem onde os contornos serão desenhados</span>
<span class="n">contornos_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Encontrando os contornos</span>
<span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask_combinada</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_CCOMP</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>

<span class="c1"># Encontrando o maior contorno</span>
<span class="n">maior_contorno</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>


<span class="c1"># Função para desenhar um crosshair</span>
<span class="k">def</span> <span class="nf">crosshair</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="c1"># Desenha um crosshair centrado no point. O point deve ser uma tupla (x,y) O color é uma tupla R,G,B uint8</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="n">x</span> <span class="o">-</span> <span class="n">size</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">color</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">img</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">-</span> <span class="n">size</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">),</span><span class="n">color</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>

<span class="c1"># Retorna uma tupla (cx, cy) que desenha o centro do contorno</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">maior</span><span class="p">)</span>

<span class="c1"># Calcula o centro do contorno</span>
<span class="n">cX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;m10&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">M</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">])</span>
<span class="n">cY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;m01&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">M</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">])</span>

<span class="c1"># Desenha o centro do contorno com um crosshair</span>
<span class="n">contornos_img</span> <span class="o">=</span> <span class="n">crosshair</span><span class="p">(</span><span class="n">contornos_img</span><span class="p">,</span> <span class="p">(</span><span class="n">cX</span><span class="p">,</span><span class="n">cY</span><span class="p">),</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_39"></h1>
<h3 id="caixa-delimitadora">Caixa Delimitadora</h3>
<p>Uma caixa delimitadora é um retângulo que delimita as coordenadas de um objeto. A caixa delimitadora é definida pelas coordenadas de seu canto <strong>superior esquerdo</strong> e sua <strong>largura e altura</strong>.</p>
<p>A função <code>cv2.boundingRect(contour)</code> retorna as coordenadas do canto superior esquerdo e a largura e altura da caixa delimitadora.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Lendo a imagem</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s2">&quot;path/exemplo.png&quot;</span><span class="p">)</span>

<span class="c1"># Imagem onde a caixa delimitadora será desenhada</span>
<span class="n">caixa_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Encontrando os contornos</span>
<span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask_combinada</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_CCOMP</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_NONE</span><span class="p">)</span>

<span class="c1"># Encontrando o maior contorno</span>
<span class="n">maior_contorno</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>

<span class="c1"># Encontrando a caixa delimitadora</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">maior_contorno</span><span class="p">)</span>

<span class="c1"># Desenhando a caixa delimitadora</span>
<span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">caixa_img</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<p><a href="#sumario">Voltar ao Sumário</a></p>
<h1 id="_40"></h1>
<h3 id="ferramenta-de-imagem">Ferramenta de Imagem</h3>
<p>Para executar a ferramenta de imagem, basta executar o comando abaixo.</p>
<p><div class="highlight"><pre><span></span><code>ros2<span class="w"> </span>run<span class="w"> </span>image_tool<span class="w"> </span>start_image_tool
</code></pre></div>
<a href="#sumario">Voltar ao Sumário</a></p>


</section>
          
        
      </main>
      <footer class="ah-footer ah-typeset">
        <div class="ah-footer-nav">
          
            <a href=".."
               class="ah-prev"
               title="Home">
              <span class="nav-label">Anterior</span>
              <span class="nav-title">Home</span>
            </a>
          
          
            <a href="../desagil/"
               class="ah-next"
               title="DesÁgil">
              <span class="nav-label">Próximo</span>
              <span class="nav-title">DesÁgil</span>
            </a>
          
        </div>
      </footer>
    </div>
    
      
    
  </body>
</html>